# ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹åˆ†æã¨æ­£ã—ã„å®Ÿè£…å®šç¾©

**Date**: 2025-11-05
**Document Type**: Critical Bug Analysis
**Related Documents**: 01-05 (åˆ†æã‚¿ãƒ–çµ±è¨ˆæ©Ÿèƒ½ã®è¨­è¨ˆ)

---

## ğŸ“‹ ç›®æ¬¡

1. [å•é¡Œã®æŒ‡æ‘˜](#å•é¡Œã®æŒ‡æ‘˜)
2. [ç¾çŠ¶ã®èª¤ã£ãŸå®Ÿè£…](#ç¾çŠ¶ã®èª¤ã£ãŸå®Ÿè£…)
3. [è¦‹å­¦è€…ï¼ˆisSpectatorï¼‰ã®èª¿æŸ»](#è¦‹å­¦è€…isspectatorã®èª¿æŸ»)
4. [0ç‚¹ï¼ˆscore === 0ï¼‰ã®å•é¡Œ](#0ç‚¹score--0ã®å•é¡Œ)
5. [æ­£ã—ã„ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å®šç¾©](#æ­£ã—ã„ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å®šç¾©)
6. [å½±éŸ¿ç¯„å›²ã¨ä¿®æ­£ç®‡æ‰€](#å½±éŸ¿ç¯„å›²ã¨ä¿®æ­£ç®‡æ‰€)
7. [å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](#å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³)

---

## å•é¡Œã®æŒ‡æ‘˜

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®æŒ‡æ‘˜

> ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã¨ã—ã¦è¦‹å­¦è€…ï¼ˆnull/0ï¼‰ã¨ã„ã†è¨˜è¿°ãŒã‚ã£ãŸãŒã€ã“ã‚Œã¯ä¸é©åˆ‡ã§ã‚ã‚‹ã€‚ãã‚‚ãã‚‚ç¾çŠ¶ã§ã¯è¦‹å­¦è€…ãŒç™ºç”Ÿã™ã‚‹ã‚ˆã†ãªå…¥åŠ›æ–¹æ³•ã®ä»•æ§˜ã«ãªã£ã¦ã„ãªã„ã€‚ã¾ãŸé€šå¸¸ã«ãƒ—ãƒ¬ã‚¤ã—ã¦ã„ã¦0ç‚¹ã«ãªã‚‹ã“ã¨ãŒã‚ã‚‹ã®ã«ã€ãã‚ŒãŒé›†è¨ˆã‹ã‚‰å¤–ã‚Œã‚‹ã®ã¯æ„å‘³ä¸æ˜ã€‚

**æŒ‡æ‘˜ã®ãƒã‚¤ãƒ³ãƒˆ**:
1. è¦‹å­¦è€…ã¯ç¾çŠ¶ã®UIã§ç™ºç”Ÿã—ãªã„
2. 0ç‚¹ã¯æ­£å¸¸ãªãƒ—ãƒ¬ã‚¤çµæœã§ã‚ã‚Šã€é›†è¨ˆå¯¾è±¡ã‹ã‚‰é™¤å¤–ã™ã¹ãã§ãªã„

---

## ç¾çŠ¶ã®èª¤ã£ãŸå®Ÿè£…

### session-utils.ts: calculateSessionSummary

#### Line 140-144: ãƒ¡ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŠè˜ã‚¹ã‚­ãƒƒãƒ—åˆ¤å®š

```typescript
// ç‚¹æ•°ãŒå…¥åŠ›ã•ã‚Œã¦ã„ãªã„åŠè˜ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆæœªå…¥åŠ›ã®åŠè˜ã¯é›†è¨ˆå¯¾è±¡å¤–ï¼‰
// é˜²å¾¡çš„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°: null or 0 ã®ä¸¡æ–¹ã‚’ã‚¹ã‚­ãƒƒãƒ—
if (mainUserResult.score === null || mainUserResult.score === 0) {  // âŒ èª¤ã‚Š
  continue
}
```

**å•é¡Œ**:
- `score === 0`ã‚’æœªå…¥åŠ›ã¨ã—ã¦æ‰±ã£ã¦ã„ã‚‹
- éº»é›€ã§Â±0ç‚¹ï¼ˆä¾‹ï¼š30000ç‚¹ã¡ã‚‡ã†ã©ï¼‰ã¯æ­£å¸¸ãªãƒ—ãƒ¬ã‚¤çµæœ
- ã“ã‚Œã‚’é™¤å¤–ã™ã‚‹ã¨ã€æ­£ã—ã„ãƒ‡ãƒ¼ã‚¿ãŒé›†è¨ˆã‹ã‚‰æ¼ã‚Œã‚‹

#### Line 203: å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç·åæ”¯è¨ˆç®—

```typescript
if (player.isSpectator || player.score === null || player.score === 0) {  // âŒ èª¤ã‚Š
  continue
}
```

**å•é¡Œ**:
- åŒæ§˜ã«`score === 0`ã‚’é™¤å¤–
- ç·åˆé †ä½è¨ˆç®—ã§0ç‚¹ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒé™¤å¤–ã•ã‚Œã‚‹

### InputTab.tsx: Line 260

```typescript
p.isSpectator || p.score === null || p.score === 0  // âŒ åŒã˜å•é¡Œ
```

**å•é¡Œ**:
- ç©ºãƒãƒ³ãƒãƒ£ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã§ã‚‚0ç‚¹ã‚’é™¤å¤–
- 0ç‚¹ã®åŠè˜ãŒã€Œç©ºã€ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹

---

## è¦‹å­¦è€…ï¼ˆisSpectatorï¼‰ã®èª¿æŸ»

### å‹å®šç¾©ï¼ˆdb.ts: Line 72ï¼‰

```typescript
export interface PlayerResult {
  // ... ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  isSpectator: boolean;      // è¦‹å­¦ãƒ•ãƒ©ã‚°
}
```

**çµè«–**: å‹å®šç¾©ä¸Šã¯å­˜åœ¨ã™ã‚‹

### UIå®Ÿè£…ï¼ˆScoreInputTable.tsx: Line 112ï¼‰

```typescript
// æ–°è¦åŠè˜è¿½åŠ æ™‚ã®åˆæœŸåŒ–
{
  playerName: p.playerName,
  userId: p.userId,
  score: null,
  umaMark: '',
  chips: 0,
  parlorFee: 0,
  isSpectator: false,  // âœ… å¸¸ã«false
  umaMarkManual: false,
}
```

**çµè«–**: å¸¸ã«`false`ã§åˆæœŸåŒ–ã€UIã§å¤‰æ›´ã™ã‚‹æ–¹æ³•ãªã—

### PlayerSelect.tsx

```bash
$ grep -n "isSpectator" app/src/components/PlayerSelect.tsx
# â†’ å‡ºåŠ›ãªã—
```

**çµè«–**: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠç”»é¢ã§ã‚‚è¦‹å­¦è€…ã‚’è¨­å®šã™ã‚‹æ©Ÿèƒ½ãªã—

### èª¿æŸ»çµæœã‚µãƒãƒªãƒ¼

| é …ç›® | çŠ¶æ…‹ | èª¬æ˜ |
|------|------|------|
| å‹å®šç¾© | âœ… å­˜åœ¨ | `PlayerResult.isSpectator: boolean` |
| UIè¨­å®šæ–¹æ³• | âŒ ãªã— | å¸¸ã«`false`ã§åˆæœŸåŒ– |
| å®Ÿéš›ã®ä½¿ç”¨ | âŒ ãªã— | ç¾çŠ¶ã®UIã§ã¯ç™ºç”Ÿã—ãªã„ |
| è¨­è¨ˆæ„å›³ | ğŸ”® å°†æ¥ç”¨ | å°†æ¥ã®æ‹¡å¼µç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ |

**çµè«–**: `isSpectator`ã¯å°†æ¥ã®æ‹¡å¼µç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã‚ã‚Šã€ç¾çŠ¶ã®UIã§ã¯`true`ã«ãªã‚‹ã“ã¨ã¯ãªã„ã€‚

---

## 0ç‚¹ï¼ˆscore === 0ï¼‰ã®å•é¡Œ

### éº»é›€ã«ãŠã‘ã‚‹0ç‚¹ã®æ„å‘³

#### æ­£å¸¸ãªã‚±ãƒ¼ã‚¹

**ã‚±ãƒ¼ã‚¹1: Â±0ç‚¹ï¼ˆåæ”¯ãªã—ï¼‰**
```
é–‹å§‹: 30000ç‚¹
çµ‚äº†: 30000ç‚¹
åæ”¯: Â±0ç‚¹ = score: 0
```

**ã‚±ãƒ¼ã‚¹2: ã‚¹ã‚³ã‚¢ã¨ã‚¦ãƒãŒç›¸æ®º**
```
ã‚¹ã‚³ã‚¢: +5000ç‚¹
ã‚¦ãƒ: -5000ç‚¹ï¼ˆâœ—ãƒãƒ¼ã‚¯ï¼‰
åˆè¨ˆ: Â±0ç‚¹ = score: 0
```

#### ç¾åœ¨ã®èª¤ã£ãŸæ‰±ã„

```typescript
if (mainUserResult.score === null || mainUserResult.score === 0) {
  continue  // âŒ ä¸Šè¨˜ã®æ­£å¸¸ãªã‚±ãƒ¼ã‚¹ãŒé›†è¨ˆã‹ã‚‰é™¤å¤–ã•ã‚Œã‚‹
}
```

**å½±éŸ¿**:
- Â±0ç‚¹ã®åŠè˜ãŒçµ±è¨ˆã‹ã‚‰å®Œå…¨ã«æ¶ˆãˆã‚‹
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚µãƒãƒªãƒ¼ã®`hanchanCount`ãŒå®Ÿéš›ã‚ˆã‚Šå°‘ãªããªã‚‹
- å¹³å‡ç€é †ã®è¨ˆç®—ãŒä¸æ­£ç¢ºã«ãªã‚‹

### æœ¬æ¥ã®ã€Œæœªå…¥åŠ›ã€ã®å®šç¾©

| çŠ¶æ…‹ | scoreå€¤ | æ„å‘³ | é›†è¨ˆå¯¾è±¡ |
|------|---------|------|---------|
| **æœªå…¥åŠ›** | `null` | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç‚¹æ•°ã‚’å…¥åŠ›ã—ã¦ã„ãªã„ | âŒ é™¤å¤– |
| **Â±0ç‚¹** | `0` | æ­£å¸¸ãªãƒ—ãƒ¬ã‚¤çµæœï¼ˆåæ”¯ãªã—ï¼‰ | âœ… å«ã‚ã‚‹ |
| **ãƒ—ãƒ©ã‚¹** | `> 0` | åæ”¯ãƒ—ãƒ©ã‚¹ | âœ… å«ã‚ã‚‹ |
| **ãƒã‚¤ãƒŠã‚¹** | `< 0` | åæ”¯ãƒã‚¤ãƒŠã‚¹ | âœ… å«ã‚ã‚‹ |

**æ­£ã—ã„åˆ¤å®š**:
```typescript
// âœ… æ­£ã—ã„å®Ÿè£…
if (mainUserResult.score === null) {  // nullã®ã¿ãƒã‚§ãƒƒã‚¯
  continue
}
```

---

## æ­£ã—ã„ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å®šç¾©

### 1. æœªå…¥åŠ›ã®åŠè˜

**å®šç¾©**: `score === null`

**åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯**:
```typescript
// âœ… æ­£ã—ã„
if (playerResult.score === null) {
  // æœªå…¥åŠ›ã¨ã—ã¦é™¤å¤–
  continue
}
```

**UIã§ã®ç™ºç”Ÿã‚¿ã‚¤ãƒŸãƒ³ã‚°**:
- åŠè˜ã‚’è¿½åŠ ã—ãŸãŒã€ã¾ã ç‚¹æ•°ã‚’å…¥åŠ›ã—ã¦ã„ãªã„
- å…¥åŠ›é€”ä¸­ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä¿å­˜ã—ãŸå ´åˆ

### 2. è¦‹å­¦è€…

**å®šç¾©**: `isSpectator === true`

**åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯**:
```typescript
// âœ… æ­£ã—ã„
if (playerResult.isSpectator) {
  // è¦‹å­¦è€…ã¨ã—ã¦é™¤å¤–
  continue
}
```

**ç¾çŠ¶**: UIã§è¨­å®šã™ã‚‹æ–¹æ³•ãŒãªã„ãŸã‚ã€å®Ÿéš›ã«ã¯ç™ºç”Ÿã—ãªã„

**å°†æ¥çš„ãªæ‹¡å¼µ**:
- è¦‹å­¦è€…ã‚’æ˜ç¤ºçš„ã«ç™»éŒ²ã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹å ´åˆã«å‚™ãˆãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- ç¾æ™‚ç‚¹ã§ã¯å¸¸ã«`false`

### 3. 0ç‚¹ï¼ˆÂ±0ç‚¹ï¼‰

**å®šç¾©**: `score === 0`

**åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯**:
```typescript
// âœ… æ­£ã—ã„ - 0ç‚¹ã¯æ­£å¸¸ãªãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦å‡¦ç†
if (playerResult.score === null) {  // nullã®ã¿ãƒã‚§ãƒƒã‚¯
  continue
}
// score === 0 ã¯é€šå¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã§é›†è¨ˆå¯¾è±¡
```

**éº»é›€ã§ã®ç™ºç”Ÿã‚±ãƒ¼ã‚¹**:
- 30000ç‚¹ã¡ã‚‡ã†ã©ã§çµ‚äº†ï¼ˆÂ±0ï¼‰
- ã‚¹ã‚³ã‚¢ã¨ã‚¦ãƒãŒç›¸æ®ºï¼ˆä¾‹ï¼š+5000ç‚¹ã€ã‚¦ãƒ-5000ç‚¹ï¼‰
- è¤‡æ•°ã®åŠè˜ã§ãƒ—ãƒ©ã‚¹ãƒã‚¤ãƒŠã‚¹ãŒç´¯ç©ã—ã¦æœ€çµ‚çš„ã«Â±0

### 4. çµ„ã¿åˆã‚ã›æ¡ä»¶

**æ­£ã—ã„é™¤å¤–æ¡ä»¶**:
```typescript
// âœ… å®Œå…¨ãªé™¤å¤–æ¡ä»¶
if (playerResult.isSpectator || playerResult.score === null) {
  continue  // è¦‹å­¦è€… OR æœªå…¥åŠ›ã®ã¿é™¤å¤–
}
// score === 0 ã¯å«ã¾ã‚Œãªã„ï¼ˆæ­£å¸¸ãƒ‡ãƒ¼ã‚¿ï¼‰
```

**èª¤ã£ãŸé™¤å¤–æ¡ä»¶**:
```typescript
// âŒ èª¤ã‚Š - 0ç‚¹ã‚’é™¤å¤–ã—ã¦ã¯ã„ã‘ãªã„
if (playerResult.isSpectator || playerResult.score === null || playerResult.score === 0) {
  continue
}
```

---

## å½±éŸ¿ç¯„å›²ã¨ä¿®æ­£ç®‡æ‰€

### ä¿®æ­£ãŒå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«

#### 1. session-utils.ts

**Line 142**: ãƒ¡ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŠè˜ã‚¹ã‚­ãƒƒãƒ—åˆ¤å®š
```typescript
// âŒ ç¾åœ¨
if (mainUserResult.score === null || mainUserResult.score === 0) {
  continue
}

// âœ… ä¿®æ­£å¾Œ
if (mainUserResult.score === null) {
  continue
}
```

**Line 203**: å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç·åæ”¯è¨ˆç®—
```typescript
// âŒ ç¾åœ¨
if (player.isSpectator || player.score === null || player.score === 0) {
  continue
}

// âœ… ä¿®æ­£å¾Œ
if (player.isSpectator || player.score === null) {
  continue
}
```

#### 2. InputTab.tsx

**Line 260**: ç©ºãƒãƒ³ãƒãƒ£ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
```typescript
// âŒ ç¾åœ¨
p.isSpectator || p.score === null || p.score === 0

// âœ… ä¿®æ­£å¾Œ
p.isSpectator || p.score === null
```

#### 3. AnalysisTab.tsx

**pointStats (Line 135)**:
```typescript
// âŒ ç¾åœ¨
if (userResult && !userResult.isSpectator && userResult.score !== null && userResult.score !== 0) {

// âœ… ä¿®æ­£å¾Œ
if (userResult && !userResult.isSpectator && userResult.score !== null) {
```

**æ³¨æ„**: revenueStats, chipStatsã¯åˆ¥é€”selectedUserIdå¯¾å¿œã®ãŸã‚ã®å¤§å¹…ãªæ›¸ãæ›ãˆãŒå¿…è¦ï¼ˆ03-IMPLEMENTATION_SPECIFICATION.mdå‚ç…§ï¼‰

### å½±éŸ¿ã‚’å—ã‘ã‚‹æ©Ÿèƒ½

| æ©Ÿèƒ½ | å½±éŸ¿ | é‡è¦åº¦ |
|------|------|--------|
| **ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚µãƒãƒªãƒ¼è¨ˆç®—** | 0ç‚¹åŠè˜ãŒé™¤å¤–ã•ã‚Œã‚‹ | ğŸ”´ Critical |
| **å±¥æ­´ã‚¿ãƒ–è¡¨ç¤º** | åŠè˜æ•°ãŒå®Ÿéš›ã‚ˆã‚Šå°‘ãªãè¡¨ç¤º | ğŸ”´ Critical |
| **åˆ†æã‚¿ãƒ–çµ±è¨ˆ** | 0ç‚¹ãƒ‡ãƒ¼ã‚¿ãŒçµ±è¨ˆã‹ã‚‰æ¼ã‚Œã‚‹ | ğŸ”´ Critical |
| **ç·åˆé †ä½è¨ˆç®—** | 0ç‚¹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒé™¤å¤–ã•ã‚Œã‚‹ | ğŸ”´ Critical |
| **å¹³å‡ç€é †è¨ˆç®—** | åˆ†æ¯ãŒèª¤ã‚‹ | ğŸ”´ Critical |

---

## å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### åŸºæœ¬åŸå‰‡

#### 1. æœªå…¥åŠ›åˆ¤å®š

```typescript
// âœ… DO: nullã®ã¿ãƒã‚§ãƒƒã‚¯
if (playerResult.score === null) {
  // æœªå…¥åŠ›ã¨ã—ã¦é™¤å¤–
}

// âŒ DON'T: 0ç‚¹ã‚’æœªå…¥åŠ›ã¨ã—ã¦æ‰±ã‚ãªã„
if (playerResult.score === null || playerResult.score === 0) {
  // èª¤ã‚Š: 0ç‚¹ã¯æ­£å¸¸ãƒ‡ãƒ¼ã‚¿
}
```

#### 2. è¦‹å­¦è€…åˆ¤å®š

```typescript
// âœ… DO: isSpectatorã®ã¿ãƒã‚§ãƒƒã‚¯
if (playerResult.isSpectator) {
  // è¦‹å­¦è€…ã¨ã—ã¦é™¤å¤–
}

// ğŸ’¡ NOTE: ç¾çŠ¶ã®UIã§ã¯å¸¸ã«falseã ãŒã€å°†æ¥ã®æ‹¡å¼µã«å‚™ãˆã¦åˆ¤å®šã¯æ®‹ã™
```

#### 3. çµ„ã¿åˆã‚ã›æ¡ä»¶

```typescript
// âœ… DO: è¦‹å­¦è€… OR æœªå…¥åŠ›
if (playerResult.isSpectator || playerResult.score === null) {
  continue
}

// âŒ DON'T: 0ç‚¹ã‚’å«ã‚ãªã„
if (playerResult.isSpectator || playerResult.score === null || playerResult.score === 0) {
  continue
}
```

### ã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°

#### æ­£ã—ã„ã‚³ãƒ¡ãƒ³ãƒˆ

```typescript
// æœªå…¥åŠ›ã®åŠè˜ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆscore === nullï¼‰
if (mainUserResult.score === null) {
  continue
}
```

#### èª¤ã£ãŸã‚³ãƒ¡ãƒ³ãƒˆï¼ˆå‰Šé™¤ã™ã¹ãï¼‰

```typescript
// âŒ å‰Šé™¤: èª¤ã£ãŸèª¬æ˜
// é˜²å¾¡çš„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°: null or 0 ã®ä¸¡æ–¹ã‚’ã‚¹ã‚­ãƒƒãƒ—
if (mainUserResult.score === null || mainUserResult.score === 0) {
  continue
}
```

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

#### 0ç‚¹ã®æ­£å¸¸ãªã‚±ãƒ¼ã‚¹

```typescript
describe('0ç‚¹ï¼ˆÂ±0ç‚¹ï¼‰ã®æ‰±ã„', () => {
  it('Â±0ç‚¹ã®åŠè˜ãŒçµ±è¨ˆã«å«ã¾ã‚Œã‚‹', () => {
    const hanchans = [
      {
        players: [
          { userId: 'user1', score: 0, isSpectator: false, ... },  // Â±0ç‚¹
          { userId: 'user2', score: 5000, isSpectator: false, ... },
          { userId: 'user3', score: -5000, isSpectator: false, ... },
        ]
      }
    ]

    const summary = calculateSessionSummary(sessionId, 'user1')

    expect(summary.hanchanCount).toBe(1)  // âœ… 0ç‚¹ã‚‚å«ã‚ã¦1åŠè˜
    expect(summary.totalPayout).toBeDefined()  // âœ… 0ç‚¹ã§ã‚‚è¨ˆç®—ã•ã‚Œã‚‹
  })
})
```

#### æœªå…¥åŠ›ã®ã‚±ãƒ¼ã‚¹

```typescript
describe('æœªå…¥åŠ›ï¼ˆnullï¼‰ã®æ‰±ã„', () => {
  it('æœªå…¥åŠ›ã®åŠè˜ãŒçµ±è¨ˆã‹ã‚‰é™¤å¤–ã•ã‚Œã‚‹', () => {
    const hanchans = [
      {
        players: [
          { userId: 'user1', score: null, isSpectator: false, ... },  // æœªå…¥åŠ›
        ]
      }
    ]

    const summary = calculateSessionSummary(sessionId, 'user1')

    expect(summary.hanchanCount).toBe(0)  // âœ… æœªå…¥åŠ›ã¯é™¤å¤–
  })
})
```

---

## ã¾ã¨ã‚

### ä¸»è¦ãªèª¤è§£

| èª¤è§£ | æ­£ã—ã„ç†è§£ |
|------|-----------|
| 0ç‚¹ = æœªå…¥åŠ› | 0ç‚¹ = æ­£å¸¸ãªãƒ—ãƒ¬ã‚¤çµæœ |
| score === 0 ã¯ã‚¹ã‚­ãƒƒãƒ—ã™ã¹ã | score === 0 ã¯é›†è¨ˆå¯¾è±¡ |
| è¦‹å­¦è€…ã¯ç¾çŠ¶ã§ç™ºç”Ÿã™ã‚‹ | è¦‹å­¦è€…ã¯ç¾çŠ¶ã®UIã§ã¯ç™ºç”Ÿã—ãªã„ |

### ä¿®æ­£ã®å„ªå…ˆåº¦

1. **ğŸ”´ Critical**: session-utils.ts (Line 142, 203)
2. **ğŸ”´ Critical**: InputTab.tsx (Line 260)
3. **ğŸŸ¡ High**: AnalysisTab.tsx (pointStats)

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. session-utils.tsã®ä¿®æ­£ï¼ˆ0ç‚¹é™¤å¤–ã‚’å‰Šé™¤ï¼‰
2. InputTab.tsxã®ä¿®æ­£ï¼ˆç©ºãƒãƒ³ãƒãƒ£ãƒ³åˆ¤å®šã‹ã‚‰0ç‚¹é™¤å¤–ã‚’å‰Šé™¤ï¼‰
3. AnalysisTab.tsxã®ä¿®æ­£ï¼ˆçµ±è¨ˆè¨ˆç®—ã®å…¨é¢æ›¸ãæ›ãˆã¨åˆã‚ã›ã¦å¯¾å¿œï¼‰
4. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ ï¼ˆ0ç‚¹ã®æ­£å¸¸å‡¦ç†ã‚’ç¢ºèªï¼‰

---

**Document Version**: 1.0
**Last Updated**: 2025-11-05
**Status**: Ready for Implementation
