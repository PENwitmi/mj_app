# 成績分析タブの画面設計

**作成日**: 2025-10-03 01:43
**ステータス**: 設計完了

---

## 📊 成績分析タブの役割

過去の対局データを統計的に分析し、自分の麻雀成績を可視化する画面。

---

## 🎯 基本設計思想

### データ集計の原則

**ポイント（点数）と収支（円）の分離**：
- **ポイント**：各半荘ごとの±点数（例：+10, -5）
  - 半荘単位での勝ち負けを表す
  - プラス/マイナスを分けて集計
- **収支（円）**：複数半荘の合計後、レート換算した金額
  - セッション単位での最終収支
  - 収入/支出を分けて集計

**4人打ちと3人打ちの分離**：
- 4人打ちの3位と3人打ちの3位は意味が異なる
- 着順統計は必ずモード別に表示
- 全体タブでは着順統計は表示しない

---

## 🎨 画面構成

### フィルターエリア（画面上部）

```
┌─────────────────────────────────────┐
│ ユーザー: [自分 ▼]  期間: [今月 ▼]  │
│ [4人打ち] [3人打ち] [全体]           │
└─────────────────────────────────────┘
```

**ユーザー選択**（ドロップダウン）：
- **デフォルト**：「自分」（メインユーザー）を選択
- **選択肢**：
  - 自分（メインユーザー）
  - 登録ユーザー全員
- **機能**：選択したユーザーの統計を表示
- **統計範囲**：選択したユーザーが参加した全セッション・全半荘

**期間フィルター**（ドロップダウン）：
- **今月**：当月のデータ（例：2025年10月）
- **今年**：当年のデータ（例：2025年）
- **2024年**：選択した年のデータ
- **2023年**：選択した年のデータ
- ... （データがある年を動的に表示）
- **全期間**：すべてのデータ

**モードフィルター**（タブ切り替え）：
- **[4人打ち]**：4人打ちのみのデータ
- **[3人打ち]**：3人打ちのみのデータ
- **[全体]**：4人打ち + 3人打ちの合算（着順統計以外）

---

## 📈 統計表示エリア

### 4人打ち/3人打ちタブの場合

```
┌─────────────────────────────────────┐
│ 期間: [今月 ▼]  [4人打ち] [3人打ち] [全体] │
├─────────────────────────────────────┤
│                                     │
│ 📊 着順統計（50半荘）                │
│ ────────────────────────────────    │
│ 1位: 15回 (30.0%)  ████████████     │
│ 2位: 12回 (24.0%)  █████████        │
│ 3位: 13回 (26.0%)  ██████████       │
│ 4位: 10回 (20.0%)  ████████         │
│ 平均着順: 2.36位                     │
│                                     │
│ 💰 収支統計                          │
│ ────────────────────────────────    │
│ 総収入: +125,000円                   │
│ 総支出: -98,000円                    │
│ ───────────────────                 │
│ 総収支: +27,000円                    │
│                                     │
│ 📈 ポイント統計                      │
│ ────────────────────────────────    │
│ プラスポイント合計: +450pt           │
│ マイナスポイント合計: -320pt         │
│ ───────────────────                 │
│ ポイント収支: +130pt                 │
│                                     │
│ 🎰 チップ統計                        │
│ ────────────────────────────────    │
│ 総チップ獲得: +23枚                  │
│                                     │
└─────────────────────────────────────┘
```

### 全体タブの場合

```
┌─────────────────────────────────────┐
│ 期間: [今月 ▼]  [4人打ち] [3人打ち] [全体] │
├─────────────────────────────────────┤
│                                     │
│ ⚠️  着順統計は表示されません          │
│ 4人打ちと3人打ちでは着順の意味が異なる│
│ ため、個別のモードタブをご覧ください。  │
│                                     │
│ 💰 収支統計                          │
│ ────────────────────────────────    │
│ 総収入: +185,000円                   │
│ 総支出: -142,000円                   │
│ ───────────────────                 │
│ 総収支: +43,000円                    │
│                                     │
│ 📈 ポイント統計                      │
│ ────────────────────────────────    │
│ プラスポイント合計: +720pt           │
│ マイナスポイント合計: -580pt         │
│ ───────────────────                 │
│ ポイント収支: +140pt                 │
│                                     │
│ 🎰 チップ統計                        │
│ ────────────────────────────────    │
│ 総チップ獲得: +35枚                  │
│                                     │
└─────────────────────────────────────┘
```

---

## 📋 統計項目の詳細

### 📊 着順統計

**表示内容**：
- 各着順（1位〜4位 or 1位〜3位）の回数と割合
- 視覚的なバーグラフ
- 平均着順（小数第2位まで）
- 半荘数の表示

**計算方法**：
- 回数：各着順の合計回数
- 割合：（各着順の回数 / 総半荘数） × 100
- 平均着順：（1×1位回数 + 2×2位回数 + 3×3位回数 + 4×4位回数） / 総半荘数

**表示条件**：
- 4人打ち or 3人打ちタブのみ表示
- 全体タブでは非表示（注意メッセージを表示）

---

### 💰 収支統計

**表示内容**：
- 総収入：最終収支がプラスだったセッションの合計
- 総支出：最終収支がマイナスだったセッションの合計
- 総収支：総収入 + 総支出

**計算方法**：
```typescript
// セッションごとの最終収支から計算
sessions.forEach(session => {
  const finalAmount = session.finalAmount; // 場代引き後の最終収支
  if (finalAmount > 0) {
    totalIncome += finalAmount;
  } else {
    totalExpense += finalAmount; // 負の値
  }
});
totalBalance = totalIncome + totalExpense;
```

**単位**：円

---

### 📈 ポイント統計

**表示内容**：
- プラスポイント合計：各半荘で勝った時の点数の合計
- マイナスポイント合計：各半荘で負けた時の点数の合計
- ポイント収支：プラスポイント + マイナスポイント

**計算方法**：
```typescript
// 各半荘ごとの点数から計算
hanchans.forEach(hanchan => {
  const score = hanchan.score; // ±形式の点数（例：+10, -5）
  if (score > 0) {
    plusPoints += score;
  } else {
    minusPoints += score; // 負の値
  }
});
pointBalance = plusPoints + minusPoints;
```

**単位**：pt（ポイント）

**収支との違い**：
- 収支：セッション単位（複数半荘の合計後、レート換算）
- ポイント：半荘単位（各半荘ごとの勝ち負け）

---

### 🎰 チップ統計

**表示内容**：
- 総チップ獲得枚数

**計算方法**：
```typescript
// セッションごとのチップ枚数を合計
const totalChips = sessions.reduce((sum, session) => {
  return sum + session.chips; // +2, -1 など
}, 0);
```

**単位**：枚

---

## 🎨 UI/UX 要件

### レイアウト
- **スクロール可能**：統計項目が多い場合に対応
- **カード形式**：各統計をカードで区切って表示
- **視覚的**：バーグラフで直感的に理解できる

### データ更新
- フィルター変更時に即座に再計算・再表示
- データがない場合：「データがありません」メッセージ

### 色分け
- 総収入・プラスポイント：青系
- 総支出・マイナスポイント：赤系
- 総収支・ポイント収支：プラスなら青、マイナスなら赤

---

## 🚀 次のステップ

1. データモデル設計（Dexie.js）
2. 各画面のコンポーネント実装
3. 統計計算ロジックの実装

---

**更新履歴**:
- 2025-10-03 01:47: ユーザー選択機能追加（登録ユーザーの統計を表示可能）
- 2025-10-03 01:43: 初回作成、成績分析タブの画面設計完了
