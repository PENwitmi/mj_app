# デフォルト値・初期設定・ルール

**作成日**: 2025-10-03 01:56
**ステータス**: 設定中

---

## 💰 レート・価値のデフォルト値

### 新規セッション作成時のデフォルト値

```
レート: 30
ウマ: 10
チップレート: 100
場代: 0
```

**各項目の説明**：

**レート（点数レート）**：
- デフォルト値：**30**
- 点数を円に換算する際の係数
- 例：小計+45 × レート30 = 1350円

**ウマ価値**：
- デフォルト値：**10**
- ウママーク1個あたりの点数価値
- 例：○○ = +2個 → +2 × 10 = +20pt

**チップレート**：
- デフォルト値：**100**
- チップ1枚あたりの円換算値
- 例：チップ+2枚 × 100 = +200円

**場代**：
- デフォルト値：**0**
- 雀荘の使用料（円）
- セッションごとに設定

---

## 🎲 点数計算の基本値

### 固定値

**返し点**：
- 30,000点（固定）
- ±点数計算の基準点

**スタート点**：
- 25,000点（固定）
- 対局開始時の持ち点

**点数計算式**：
```
±点数 = (終了点数 - 30000) / 1000
```

例：
- 終了40,000点 → (40000 - 30000) / 1000 = **+10**
- 終了25,000点 → (25000 - 30000) / 1000 = **-5**

---

## 🎯 ウマ自動割り当てルール

### 4人打ち

**ルールA: 標準ルール**
```
1位: ○○
2位: ○
3位: ✗
4位: ✗✗
```
- 着順のみで判定
- 点数の正負は関係なし

**ルールB: 2位マイナス判定ルール（ローカルルール）**

通常時（2位がプラス）：
```
1位: ○○
2位: ○
3位: ✗
4位: ✗✗
```

2位がマイナスの場合：
```
1位: ○○○
2位: 無印
3位: ✗
4位: ✗✗
```

**判定ロジック**：
```typescript
if (ルールB選択 && 2位の点数 < 0) {
  1位: ○○○
  2位: 無印
  3位: ✗
  4位: ✗✗
} else {
  1位: ○○
  2位: ○
  3位: ✗
  4位: ✗✗
}
```

**設定方法**：
- 設定タブで「ウマルール」を選択可能
- デフォルト：ルールA（標準ルール）

---

### 3人打ち

**ルールA: 標準ルール**
```
1位: ○○
2位: ○
3位: ✗✗✗
```
- 2位がプラスの場合
- 合計：○3つ、✗3つ

**ルールB: 2位マイナス判定ルール（ローカルルール）**

2位がプラスの場合：
```
1位: ○○
2位: ○
3位: ✗✗✗
```

2位がマイナスの場合：
```
1位: ○○○
2位: ✗
3位: ✗✗
```

**判定ロジック**：
```typescript
if (ルールB選択 && 2位の点数 < 0) {
  1位: ○○○
  2位: ✗
  3位: ✗✗
} else {
  1位: ○○
  2位: ○
  3位: ✗✗✗
}
```

**重要な原則**：
- どのケースでも**○と✗の合計数が一致**
- 4人打ち：○3つ、✗3つ
- 3人打ち：○3つ、✗3つ
- ゼロサム原則と同様

---

### 同点時の処理

**同点の場合**：
- 入力順（上家優先など）で仮に自動割り当て
- 実際のルール（上家が上位など）と異なる場合は手動で調整
- 特別な処理は不要（通常フローで対応）

**実際の麻雀ルール**：
- 通常は上家が上位
- 状況によって異なる場合は手動調整で対応

---

## 👤 初回起動時の設定

### メインユーザー（自分）の設定

**採用：デフォルト「自分」で開始**
- 初回セットアップ画面なし
- デフォルトで「自分」という名前のメインユーザーを自動作成
- 設定タブでいつでも名前変更可能
- シンプルですぐに使い始められる

**動作**：
1. アプリ初回起動
2. 自動的に「自分」というメインユーザーを作成
3. そのまま新規入力タブが表示される
4. 必要に応じて設定タブで名前変更

---

## ✅ バリデーション

### 入力制限

**点数（±形式）**：
- 範囲：-100 〜 +100
- 理由：通常の麻雀では±100を超えることはまずない

**チップ枚数**：
- 範囲：-50 〜 +50
- 理由：極端な値を防ぐ

**ユーザー名**：
- 文字数：1〜20文字
- 空白のみは不可
- 重複は警告（登録は可能）

**レート・ウマ・チップレート**：
- 範囲：1 〜 10000
- 0は不可（計算エラー防止）

**場代**：
- 範囲：0 〜 100000
- 負の値は不可

---

## 🗑️ データ管理

### 削除機能

**履歴の削除**：
- セッション単位で削除可能
- 確認ダイアログ表示
- 削除後は復元不可

**ユーザーの削除**：
- 設定タブから削除可能
- 過去のデータは名前のみ残る
- 統計からは除外

### バックアップ・エクスポート

**優先度：低（将来実装予定）**
- JSONエクスポート機能
- データインポート機能
- 自動バックアップ

---

## 📝 その他の機能

### セッションの途中保存（下書き）

**優先度：低（将来実装予定）**
- 入力途中のセッションを一時保存
- 後から編集再開

現時点では：
- 入力途中でも画面を離れるとデータは残らない
- セッション保存時に確定

---

## 🚀 実装状況まとめ

### ✅ すべての主要仕様が決定済み

**基本設定**：
- ✅ デフォルト値（レート30、ウマ10、チップレート100、場代0）
- ✅ 初回起動時の挙動（デフォルト「自分」で開始）
- ✅ 返し点30,000、スタート点25,000（固定）

**ウマルール**：
- ✅ 4人打ち（標準 & 2位マイナス判定）
- ✅ 3人打ち（標準 & 2位マイナス判定）
- ✅ ウママークの手動変更機能（タップして選択）
- ✅ 同点時の処理（入力順で自動割り当て→手動調整）

**機能設計**：
- ✅ 4つのタブ構成（入力・履歴・分析・設定）
- ✅ ユーザー管理（自動登録・手動登録）
- ✅ 抜け番対応（見学機能）
- ✅ 自動計算（ゼロサム原則）
- ✅ 統計分析（ポイント・収支分離）

### 実装しながら調整可能
- バリデーションの範囲値
- エラーメッセージの文言
- UIの細かい挙動

### 将来実装予定
- バックアップ/エクスポート機能
- セッション途中保存機能

---

**更新履歴**:
- 2025-10-03 02:10: 初回起動時の挙動を確定（デフォルト「自分」で開始）、すべての主要仕様が決定完了
- 2025-10-03 02:08: ウママークの手動変更機能を明記、同点時の処理を確定
- 2025-10-03 02:05: 3人打ちの2位マイナス判定ルールを追加、ウマの合計原則を明記
- 2025-10-03 02:03: 4人打ちの2位マイナス判定ルール（ローカルルール）を追加
- 2025-10-03 01:56: 初回作成、デフォルト値とルールの整理
