# プレイヤープロフィール詳細機能 将来構想

**作成日**: 2025-11-18 00:44
**ステータス**: 将来構想（練り甲斐あり、今後の課題）
**優先度**: 中（Phase 2以降で検討）

---

## 📋 概要

各プレイヤーの詳細な成績・統計を一覧できる専用ページ。セット麻雀の楽しみを増やし、個人の成長を可視化する。

---

## 🎯 目的

1. **個人成績の可視化**: 自分の強み・弱みを理解
2. **競争心の刺激**: 仲間内でのランキング意識
3. **成長の実感**: 長期的な上達を数値で確認
4. **話題作り**: プロフィールを見ながらの雑談

---

## 📊 表示する統計情報（案）

### セクション1: 基本成績

```
┌─────────────────────────┐
│ 山田太郎                 │
│ 登録日: 2025-08-01       │
├─────────────────────────┤
│ 総セッション数    24回   │
│ 総半荘数          72局   │
│ 総収支        +45,000円  │
│ 平均収支      +1,875円/回│
└─────────────────────────┘
```

**表示項目**:
- 総セッション数
- 総半荘数
- 総収支（金額）
- 総ポイント
- 平均収支（セッションあたり）
- 平均収支（半荘あたり）
- 平均着順（1.00 = 全てトップ、4.00 = 全てラス）

### セクション2: 着順分布

```
┌─────────────────────────┐
│ 着順分布                 │
├─────────────────────────┤
│ トップ  18回 (25.0%) ███│
│ 2着     22回 (30.6%) ████│
│ 3着     20回 (27.8%) ███│
│ ラス    12回 (16.7%) ██ │
├─────────────────────────┤
│ 平均着順: 2.36          │
└─────────────────────────┘
```

**表示項目**:
- トップ/2着/3着/ラス の回数・割合
- 棒グラフ表示
- 平均着順

### セクション3: 記録

```
┌─────────────────────────┐
│ 記録                     │
├─────────────────────────┤
│ 最高得点    +28,000点   │
│ 最低得点    -32,000点   │
│ 最大収支    +15,000円   │
│ 連続トップ   4回        │
│ 連続ラス     2回        │
└─────────────────────────┘
```

**表示項目**:
- 最高得点（1半荘）
- 最低得点（1半荘）
- 最大収支（1セッション）
- 最小収支（1セッション）
- 連続トップ記録
- 連続ラス記録

### セクション4: 推移グラフ

```
┌─────────────────────────┐
│ 収支推移（累積）         │
├─────────────────────────┤
│  60k│             ╱      │
│  40k│          ╱         │
│  20k│      ╱             │
│   0 │──────────────────  │
│ -20k│                    │
│     8月  9月  10月 11月  │
└─────────────────────────┘
```

**表示項目**:
- 累積収支グラフ（折れ線）
- 月別収支グラフ（棒）
- 平均着順推移（折れ線）

### セクション5: 傾向分析

```
┌─────────────────────────┐
│ 傾向分析                 │
├─────────────────────────┤
│ モード別                 │
│ ・4人打ち  +30,000円    │
│ ・3人打ち  +15,000円    │
│                          │
│ 時間帯別                 │
│ ・昼      +10,000円      │
│ ・夜      +35,000円      │
│                          │
│ 曜日別                   │
│ ・金曜日  +20,000円      │
│ ・土曜日  +15,000円      │
│ ・日曜日  +10,000円      │
└─────────────────────────┘
```

**表示項目**:
- モード別成績（4人打ち vs 3人打ち）
- 時間帯別成績（昼 vs 夜）
- 曜日別成績
- 月別参加回数

### セクション6: 対戦相手別成績（高度）

```
┌─────────────────────────┐
│ 対戦相手別成績           │
├─────────────────────────┤
│ vs 佐藤花子              │
│ 対戦回数: 18回           │
│ 収支: +12,000円          │
│ 勝率: 61.1% (11勝7敗)    │
│                          │
│ vs 鈴木一郎              │
│ 対戦回数: 20回           │
│ 収支: -8,000円           │
│ 勝率: 40.0% (8勝12敗)    │
└─────────────────────────┘
```

**表示項目**:
- 各相手との対戦成績
- 収支・勝率
- 相性分析（得意/苦手）

### セクション7: 参加履歴

```
┌─────────────────────────┐
│ 最近の参加               │
├─────────────────────────┤
│ 2025-11-17 金曜麻雀会    │
│ 2位 +5,000円 ⭕         │
│                          │
│ 2025-11-10 土曜麻雀会    │
│ 1位 +12,000円 ⭕⭕⭕    │
│                          │
│ 2025-11-03 金曜麻雀会    │
│ 3位 -3,000円 ❌         │
│                          │
│ [もっと見る]             │
└─────────────────────────┘
```

**表示項目**:
- 最近10件のセッション結果
- 「もっと見る」で全履歴表示

---

## 🎨 UI設計

### アクセス方法

#### 方法1: 設定タブから（推奨）
```
設定タブ > プレイヤー管理 > プレイヤー名タップ
→ プロフィールページ表示
```

#### 方法2: 分析タブから
```
分析タブ > ユーザー選択 > 「詳細プロフィール」ボタン
→ プロフィールページ表示
```

#### 方法3: 履歴タブから
```
履歴タブ > セッション詳細 > プレイヤー名タップ
→ プロフィールページ表示
```

### 表示形式

**Option A: フルスクリーンモーダル**
- 画面全体を使用
- スクロール可能
- 「×」で閉じる

**Option B: 新しいページ（ルーティング）**
- `/profile/:userId` のようなURL
- ブラウザバック対応

---

## 🔧 技術仕様（概要）

### データ取得

```typescript
interface PlayerProfile {
  user: User;
  stats: {
    totalSessions: number;
    totalHanchans: number;
    totalRevenue: number;
    averageRevenue: number;
    averageRank: number;
  };
  distribution: {
    top: number;
    second: number;
    third: number;
    last: number;
  };
  records: {
    maxScore: number;
    minScore: number;
    maxRevenue: number;
    consecutiveTop: number;
    consecutiveLast: number;
  };
  trends: {
    byMode: Record<GameMode, number>;
    byTimeOfDay: Record<string, number>;
    byDayOfWeek: Record<string, number>;
  };
  vsOpponents: Array<{
    opponent: User;
    matchCount: number;
    revenue: number;
    winRate: number;
  }>;
  recentSessions: Array<{
    session: Session;
    result: PlayerResult;
  }>;
}
```

### 計算ロジック

```typescript
/**
 * プレイヤープロフィール取得
 */
async function getPlayerProfile(userId: string): Promise<PlayerProfile> {
  // 全セッション取得
  const sessions = await db.sessions
    .where('playerIds')
    .equals(userId)
    .toArray();

  // 統計計算
  const stats = calculatePlayerStats(userId, sessions);
  const distribution = calculateDistribution(userId, sessions);
  const records = calculateRecords(userId, sessions);
  const trends = calculateTrends(userId, sessions);
  const vsOpponents = calculateVsOpponents(userId, sessions);
  const recentSessions = getRecentSessions(userId, sessions, 10);

  return {
    user: await db.users.get(userId),
    stats,
    distribution,
    records,
    trends,
    vsOpponents,
    recentSessions
  };
}
```

---

## 📱 実装ファイル（予定）

### 新規作成

1. **`src/lib/player-profile-utils.ts`** (300-400行)
   - `getPlayerProfile()`
   - `calculatePlayerStats()`
   - `calculateDistribution()`
   - `calculateRecords()`
   - `calculateTrends()`
   - `calculateVsOpponents()`

2. **`src/components/PlayerProfileDialog.tsx`** (400-500行)
   - フルスクリーンモーダル
   - 各セクションコンポーネント

3. **`src/components/PlayerProfileCharts.tsx`** (200-300行)
   - 収支推移グラフ
   - 着順分布グラフ
   - 月別参加グラフ

### 修正

4. **`src/components/tabs/SettingsTab.tsx`**
   - プレイヤー名クリック → プロフィール表示

5. **`src/components/tabs/AnalysisTab.tsx`**
   - 「詳細プロフィール」ボタン追加

---

## 🚧 検討事項（要設計）

### 1. パフォーマンス最適化

**課題**:
- 全セッションデータの取得・計算が重い
- 大量データ（100セッション以上）での動作

**解決策**:
- キャッシュ戦略（計算結果を保存）
- インクリメンタル更新（差分計算）
- Web Worker使用（バックグラウンド計算）

### 2. 対戦相手別成績の定義

**課題**:
- 「勝率」の定義が曖昧
- 3人打ち・4人打ち混在時の扱い

**案**:
- 勝率 = 相手より上位だった割合
- モード別に分けて表示

### 3. 相性分析の見せ方

**課題**:
- 「相性が良い」「相性が悪い」の基準
- ネガティブな表現の扱い

**案**:
- 「得意な相手」「苦手な相手」TOP3のみ表示
- 全体はタップで展開

### 4. プライバシー配慮

**課題**:
- 他プレイヤーのプロフィールを誰でも見られる？

**案**:
- デフォルト: 自分のみ閲覧可能
- オプション: 公開設定（将来機能）

### 5. データ移行・互換性

**課題**:
- 過去データが増えるほど計算量増加

**案**:
- サマリーデータを事前計算してDB保存
- `PlayerStatsSummary`テーブル追加

---

## 🎯 段階的実装案

### Phase 2.1（基本実装）
- 基本成績セクション
- 着順分布セクション
- 記録セクション
- 参加履歴セクション

**工数**: 3-4日

### Phase 2.2（グラフ追加）
- 収支推移グラフ
- 月別収支グラフ
- 着順分布グラフ

**工数**: 2-3日

### Phase 2.3（傾向分析）
- モード別成績
- 時間帯別成績
- 曜日別成績

**工数**: 2-3日

### Phase 2.4（対戦相手別）
- 対戦相手別成績
- 相性分析
- ランキング表示

**工数**: 3-4日

**総工数**: 10-14日（約2週間）

---

## 💡 追加アイデア

### 称号・バッジシステム
- 「連続トップ王」「逆転王」等の称号
- プロフィールに表示
- 達成時に通知

### プレイスタイル診断
- 「攻撃型」「守備型」等の分類
- AI分析（将来構想）

### ランキング機能
- グループ内順位
- 月間MVP

---

## 📈 成功指標

- プロフィール閲覧率: ユーザーの80%以上が自分のプロフィールを閲覧
- 滞在時間: 平均2分以上
- リピート率: 週1回以上閲覧

---

## 🔗 関連ドキュメント

- `01-FEATURE_IDEAS.md`: セット麻雀特化機能企画
- `src/components/tabs/AnalysisTab.tsx`: 既存の統計計算ロジック
- `src/lib/analysis.ts`: 分析タブの統計関数

---

## 📝 更新履歴

- **2025-11-18 00:44**: 初版作成（将来構想のアイデア整理）

---

## 🤔 次のステップ

プレイヤープロフィール機能は**練り甲斐がある大きな機能**です。実装前に以下を検討する必要があります：

1. **要件定義の深堀り**
   - どの統計が本当に必要か？
   - ユーザーは何を見たいか？

2. **技術設計の詳細化**
   - パフォーマンス最適化戦略
   - キャッシュ設計
   - データモデル拡張

3. **UI/UXの詳細設計**
   - ワイヤーフレーム作成
   - インタラクションデザイン
   - モバイルでの操作性

4. **実装計画の策定**
   - Phase分割
   - 優先順位付け
   - 工数見積もり

**推奨**: まずは小さく始める（Phase 2.1のみ実装）→ ユーザーフィードバック → 拡張
